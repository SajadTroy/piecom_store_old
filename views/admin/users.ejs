<div class="admin-container">
    <div class="page-header">
        <h2>Users Management</h2>
    </div>

    <div class="table-card">
        <% if (users && users.length > 0) { %>
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Orders</th>
                            <th>Status</th>
                            <th>Joined</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% users.forEach(user => { %>
                            <tr>
                                <td><%= user.email %></td>
                                <td><%= user.phone %></td>
                                <td><%= user.orderCount %></td>
                                <td>
                                    <% if (user.isVerified) { %>
                                        <span class="status active">Verified</span>
                                    <% } else { %>
                                        <span class="status inactive">Unverified</span>
                                    <% } %>
                                </td>
                                <td><%= new Date(user.createdAt).toLocaleDateString() %></td>
                                <td>
                                    <button class="toggle-block-btn <%= user.isBlocked ? 'unblock' : 'block' %>" 
                                            data-id="<%= user._id %>" 
                                            data-blocked="<%= user.isBlocked %>">
                                        <% if (user.isBlocked) { %>
                                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                                <path d="M8.809 6A6 6 0 0 1 18 9.352M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                                            </svg>
                                            <span>Unblock</span>
                                        <% } else { %>
                                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                                <path d="M8.809 6A6 6 0 0 1 18 9.352m3 2.648a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                                                <path d="m4 20 16-16"/>
                                            </svg>
                                            <span>Block</span>
                                        <% } %>
                                    </button>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        <% } else { %>
            <div class="no-data">
                <svg width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                    <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                    <path d="M14.5 9.25a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0m3 10.25c-.317-6.187-9.683-6.187-10 0"/>
                </svg>
                <p>No users available</p>
            </div>
        <% } %>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.toggle-block-btn').forEach(button => {
        button.addEventListener('click', async function() {
            const userId = this.dataset.id;
            const isBlocked = this.dataset.blocked === 'true';
            
            try {
                const response = await fetch(`/admin/users/${userId}/toggle-block`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ blocked: !isBlocked })
                });

                if (response.ok) {
                    location.reload();
                }
            } catch (error) {
                alert('Error updating user status');
            }
        });
    });
});
</script>
