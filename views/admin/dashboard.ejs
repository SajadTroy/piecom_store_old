<link rel="stylesheet" href="/cdn/css/admin.css">

<div class="admin-container">
    <div class="analytics-grid">
        <div class="analytics-card">
            <div class="analytics-icon orders">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                    stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d='m12 21 8.131-4.208c.316-.164.474-.245.589-.366a1 1 0 0 0 .226-.373c.054-.159.054-.336.054-.692V7.533M12 21l-8.131-4.208c-.316-.164-.474-.245-.589-.366a1 1 0 0 1-.226-.373C3 15.894 3 15.716 3 15.359V7.533M12 21v-9.063m9-4.404-9 4.404m9-4.404-4.5-2.33M3 7.534l8.269-4.28c.268-.138.401-.208.542-.235a1 1 0 0 1 .378 0c.14.027.274.097.541.235l3.77 1.95M3 7.534l4.5 2.202m4.5 2.202L7.5 9.735m0 0 9-4.531m-9 4.531v2.202' />
                </svg>
            </div>
            <div class="analytics-info">
                <h3>Total Orders</h3>
                <p class="analytics-value">
                    <%= totalOrders %>
                </p>
                <p class="analytics-change <%= changes.orders >= 0 ? 'positive' : 'negative' %>">
                    <%= changes.orders>= 0 ? '+' : '' %><%= changes.orders.toFixed(1) %>% from last month
                </p>
            </div>
        </div>

        <div class="analytics-card">
            <div class="analytics-icon revenue">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                    stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d='M17 5h-5m0 0H9.5a3.5 3.5 0 1 0 0 7H12m0-7V3m0 2v7m0 0h2.5a3.5 3.5 0 1 1 0 7H12m0-7v7m0 0H6m6 0v2' />
                </svg>
            </div>
            <div class="analytics-info">
                <h3>Total Revenue</h3>
                <p class="analytics-value">₹<%= totalRevenue %>
                </p>
                <p class="analytics-change <%= changes.revenue >= 0 ? 'positive' : 'negative' %>">
                    <%= changes.revenue>= 0 ? '+' : '' %><%= changes.revenue.toFixed(1) %>% from last month
                </p>
            </div>
        </div>

        <div class="analytics-card">
            <div class="analytics-icon users">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                    stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <path d='M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0' />
                    <path d='M14.5 9.25a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0M17 19.5c-.317-6.187-9.683-6.187-10 0' />
                </svg>
            </div>
            <div class="analytics-info">
                <h3>Total Users</h3>
                <p class="analytics-value">
                    <%= totalUsers %>
                </p>
                <p class="analytics-change <%= changes.users >= 0 ? 'positive' : 'negative' %>">
                    <%= changes.users>= 0 ? '+' : '' %><%= changes.users.toFixed(1) %>% from last month
                </p>
            </div>
        </div>

        <div class="analytics-card">
            <div class="analytics-icon products">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                    stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d='M17 3H7a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1M6 6H3m3 4H3m3 4H3m3 4H3M21 6h-3m3 4h-3m3 4h-3m3 4h-3' />
                </svg>
            </div>
            <div class="analytics-info">
                <h3>Total Products</h3>
                <p class="analytics-value">
                    <%= totalProducts %>
                </p>
                <p class="analytics-change <%= changes.products >= 0 ? 'positive' : 'negative' %>">
                    <%= changes.products>= 0 ? '+' : '' %><%= changes.products.toFixed(1) %>% from last month
                </p>
            </div>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <h3>Monthly Revenue</h3>
            <div class="chart-container">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>Orders Status</h3>
            <div class="chart-container">
                <canvas id="ordersChart"></canvas>
            </div>
        </div>
    </div>

    <div class="recent-section">
        <h3>Recent Orders</h3>
        <div class="table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Status</th>
                        <th>Amount</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    <% recentOrders.forEach(order=> { %>
                        <tr>
                            <td>#<%= order._id.slice(-6) %>
                            </td>
                            <td>
                                <%= order.customer %>
                            </td>
                            <td><span class="status <%= order.status.toLowerCase() %>">
                                    <%= order.status %>
                                </span></td>
                            <td>₹<%= order.amount %>
                            </td>
                            <td>
                                <%= new Date(order.date).toLocaleDateString() %>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: <%= JSON.stringify(monthLabels) %>,
            datasets: [{
                label: 'Revenue',
                data: <%= JSON.stringify(revenueData) %>,
                borderColor: '#333',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    // Orders Chart
    const ordersCtx = document.getElementById('ordersChart').getContext('2d');
    new Chart(ordersCtx, {
        type: 'doughnut',
        data: {
            labels: ['Delivered', 'Pending', 'Processing'],
            datasets: [{
                data: <%= JSON.stringify(orderStatusData) %>,
                backgroundColor: ['#00aa69', '#ff9800', '#2196f3']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
</script>